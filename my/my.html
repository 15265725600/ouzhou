<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>欧洲精英汇</title>
  <link rel="stylesheet" href="../assets/css/amazeui.min.css">
  <link rel="stylesheet" href="../assets/css/hm_ozjyh.css">
</head> 
<body> 

<div class="my" id="my-cont">
    
   

</div>                  

<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/amazeui.min.js"></script>
<script src="../assets/js/exif.min.js"></script>
<script src="../assets/js/template.js"></script>
<script src="../assets/js/hm_ozjyh.js"></script>

<!-- 大客户 -->
<script type="text/html" id="my-customer">
    <div style="background-color: #fff">
        <div class="top-wrap">
            <a href="javascript:history.back()" class="icon-back"></a>
            <div class="img-wrap">
                {{if avatar}}
                <img src="{{avatar}}">
                <input type="file" class="j-file">
                {{else}}
                <img src="../assets/i/avatar-default.jpg">
                {{/if}}
            </div>
            {{if username}}
            <span class="name">{{username}}</span>
            {{else }}
            <a class="name" href="javascript:location.href=preUrl('login/login.html')">去登录</a>
            {{/if}}
        </div>
    
        <div class="order-state">
            <div class="single">
                <a class="am-block item" href="javascript:location.href=preUrl('my/order.html?status=2')">
                    <i class="icon-dfh"></i>
                    <span>待发货</span>
                </a>        
                <a class="am-block item" href="javascript:location.href=preUrl('my/order.html?status=3')">
                    <i class="icon-dsh"></i>
                    <span>待收货</span>
                </a>
            </div>
            <a class="all" href="javascript:location.href=preUrl('my/order.html?status=4')" style="border-right: 1px solid #d9d9d9">
                <i class="icon-ywc"></i>
                <span>已完成</span>
            </a>
            <a class="all" href="javascript:location.href=preUrl('my/order.html?status=1')">
                <i class="icon-all"></i>
                <span>全部订单</span>
            </a>
        </div>
        
        <div class="base-wrap">
            <div class="base-item">
                <a class="am-block" href="javascript:location.href=preUrl('my/psw.html')">
                    密码管理
                    <i class="icon-forward am-fr"></i>
                </a>
            </div>
            <div class="base-item">
                客服微信
                <span class="am-fr am-padding-right-sm">KMLDKKM</span>
            </div>
        </div>
    </div>

    <a class="btn-lg j-unlogin" href="#">退出登录</a>

     <!-- 退出登录弹框 -->
    <div class="am-modal am-modal-confirm oz-confirm" tabindex="-1" id="m-unlogin">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">您确定要退出账号？</div>
            <div class="am-modal-bd">
                退出后将无法购物
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            </div>
        </div>
    </div> 
</script>

<!-- 代理商 -->
<script type="text/html" id="my-identity">
    <div style="background-color: #fff">
        <div class="top-wrap">
            <a href="javascript:history.back()" class="icon-back"></a>
            <div class="img-wrap">
                {{if avatar}}
                <img src="{{avatar}}">
                <input type="file" class="j-file">
                {{else}}
                <img src="../assets/i/avatar-default.jpg">
                <input type="file" class="j-file">
                {{/if}}
            </div>
            {{if username}}
            <span class="name">{{username}}</span>
            {{else }}
            <a class="name" href="javascript:location.href=preUrl('login/login.html')">去登录</a>
            {{/if}}
        </div>
    
        <div class="order-state">
            <div class="single">
                <a class="am-block item" href="javascript:location.href=preUrl('my/order_agent.html?status=1')">
                    <i class="icon-dqr"></i>
                    <span>待确认</span>
                </a>           
                <a class="am-block item" href="javascript:location.href=preUrl('my/order_agent.html?status=3')">
                    <i class="icon-dsh"></i>
                    <span>待收货</span>
                </a>
            </div>
            <div class="single">
                <a class="am-block item" href="javascript:location.href=preUrl('my/order_agent.html?status=2')">
                    <i class="icon-dfh"></i>
                    <span>待发货</span>
                </a>           
                <a class="am-block item" href="javascript:location.href=preUrl('my/order_agent.html?status=4')">
                    <i class="icon-ywc"></i>
                    <span>已完成</span>
                </a>
            </div>
            <a class="all" href="javascript:location.href=preUrl('my/order_agent.html?status=0')">
                <i class="icon-all"></i>
                <span>全部订单</span>
            </a>
        </div>
        
        <div class="base-wrap">
            <div class="base-item">
                <a class="am-block" href="javascript:location.href=preUrl('my/addr.html')">
                    收货信息管理
                    <i class="icon-forward am-fr"></i>
                </a>
            </div>
            <div class="base-item">
                <a class="am-block" href="javascript:location.href=preUrl('my/psw.html')">
                    密码管理
                    <i class="icon-forward am-fr"></i>
                </a>
            </div>
            <div class="base-item">
                客服微信
                <span class="am-fr am-padding-right-sm">KMLDKKM</span>
            </div>
        </div>
    </div>

    <a class="btn-lg j-unlogin" href="#">退出登录</a>
    <!-- 退出登录弹框 -->
    <div class="am-modal am-modal-confirm oz-confirm" tabindex="-1" id="m-unlogin">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">您确定要退出账号？</div>
            <div class="am-modal-bd">
                退出后将无法购物
            </div>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            </div>
        </div>
    </div> 
</script>

<script type="text/javascript">
    $(function(){
        var token = store.getCookie("token");
        var ident_type = parseInt(store.getInfo('ident_type'));
        console.log(ident_type);
        var params = {
            token: token
        }

        if (ident_type === 1) { // 大客户
            postAjax(reqUrl('mainclient_get'), params, true, function(data){
                if (data.error_code == '200') {
                    window.location.href = preUrl('login/login.html');
                    var html = template('my-customer', data.infor); 
                    $('.my').html(html);
                } else if (data.success){  
                    var html = template('my-customer', data.infor[0]); 
                    $('.my').html(html);

                    // 大客户退出登录
                    $('.j-unlogin').on('click', function(){
                        console.log('ok');
                        $('#m-unlogin').modal({
                            onConfirm: function(){
                                postAjax(reqUrl('client_loginout'), params, true, function(data){
                                    window.location.href = preUrl('index/index.html')
                                });
                            }
                        });

                        return false;
                    });

                    // 上传头像
                $('.j-file').on('change',function(e){
                    if (!window.FileReader) return; 

                    e.stopPropagation();
                    e.preventDefault(); 
                    console.log('ok');
                    var file = e.target.files[0];  
                    var content = '';
               
                    if (!file.type.match('image.*')) {  
                        alert('文件'+ f.name + '不是图片') 
                        return;   
                    }   

                    var orientation;
                    //EXIF js 可以读取图片的元信息 https://github.com/exif-js/exif-js
                    EXIF.getData(file,function(){
                        orientation=EXIF.getTag(this,'Orientation');
                    });

                    var reader = new FileReader();  
                    
                    reader.onload = function(e){             
                        getImgData(this.result,orientation,function(data){
                            console.log(data);
                            var imgData = data;
                            $('.j-file').prev().attr('src', data);
                            var params = {
                                token: token,
                                base_img: data
                            }
                            postAjax(reqUrl('upload_avatar'), params, true, function(data){
                                console.log(data);
                                if(data.error_code == '200') {
                                    window.location.href = preUrl('login/login.html');
                                } else if (data.success) {
                                    mask('保存成功');
                                } else {
                                    mask(data.msg);
                                }
                            });
                        });
                           
                    } 
                    reader.readAsDataURL(file);     
                });
                } else {
                    mask(data.msg);
                }
            });
        } else { // 代理商
            postAjax(reqUrl('agent_get'), params, true, function(data){
                if (data.error_code == '200') {
                    window.location.href = preUrl('login/login.html');
                } else if (data.success){
                    var html = template('my-identity', data.infor[0]);
                    $('.my').html(html);
                } else {
                    mask(data.msg);
                }

                // 退出登录
                $('.j-unlogin').on('click', function(){
                    console.log('ok');
                    $('#m-unlogin').modal({
                        onConfirm: function(){
                            postAjax(reqUrl('client_loginout'), params, true, function(data){
                                window.location.href = preUrl('index/index.html')
                            });
                        }
                    });

                    return false;
                });

                // 上传头像
                $('.j-file').on('change',function(e){
                    if (!window.FileReader) return; 

                    e.stopPropagation();
                    e.preventDefault(); 
                    console.log('ok');
                    var file = e.target.files[0];  
                    var content = '';
               
                    if (!file.type.match('image.*')) {  
                        alert('文件'+ f.name + '不是图片') 
                        return;   
                    }   

                    var orientation;
                    //EXIF js 可以读取图片的元信息 https://github.com/exif-js/exif-js
                    EXIF.getData(file,function(){
                        orientation=EXIF.getTag(this,'Orientation');
                    });

                    var reader = new FileReader();  
                    
                    reader.onload = function(e){             
                        getImgData(this.result,orientation,function(data){
                            console.log(data);
                            var imgData = data;
                            $('.j-file').prev().attr('src', data);
                            var params = {
                                token: token,
                                base_img: data
                            }
                            postAjax(reqUrl('upload_avatar'), params, true, function(data){
                                console.log(data);
                                if(data.error_code == '200') {
                                    window.location.href = preUrl('login/login.html');
                                } else if (data.success) {
                                    mask('保存成功');
                                } else {
                                    mask(data.msg);
                                }
                            });
                        });
                           
                    } 
                    reader.readAsDataURL(file);     
                });

            });
        }

        
    });
</script>
</body>
</html>

